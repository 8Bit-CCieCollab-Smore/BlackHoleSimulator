<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Black Hole Playground ‚Äî Core+Visuals</title>
<style>
  :root{ --panel:#0d1022cc; --text:#eef2ff; --muted:#aab2d6; }
  html,body{margin:0;height:100%;background:#0b0c13;color:var(--text);font:14px/1.2 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  canvas{position:absolute;inset:0;width:100%;height:100%;display:block}
  #ui{position:absolute;top:12px;left:12px;width:360px;max-height:88vh;overflow:auto;
      background:var(--panel);backdrop-filter:blur(6px);border:1px solid #1b2140;border-radius:16px;
      box-shadow:0 10px 30px #0008;padding:12px}
  #ui h1{font-size:16px;margin:0 0 8px}
  #ui .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
  #ui .row{display:flex;gap:8px;align-items:center;margin:6px 0}
  button{background:#1a1f39;color:var(--text);border:1px solid #2a3260;border-radius:10px;padding:8px 10px;cursor:pointer}
  button:hover{border-color:#3b4890}
  label{color:var(--muted)} small{color:var(--muted)} #fps{color:var(--muted)}
  .nameTag{position:absolute;pointer-events:none;color:#eef2ff;text-shadow:0 0 6px #000,0 0 12px #000;font-weight:700}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div id="ui">
  <h1>üåÄ Black Hole Playground ‚Äî Core + Visuals</h1>

  <div class="grid">
    <button id="addBH">+ Black Hole</button>
    <button id="addStar">+ Star</button>
    <button id="addPlanet">+ Planet</button>
    <button id="clear">üßπ Clear</button>
    <button id="pause">‚è∏Ô∏è Pause</button>
    <button id="step">‚û°Ô∏è Step</button>
  </div>

  <div class="row"><label>Gravity G: <b id="gVal"></b></label><input id="g" type="range" min="0.15" max="2.0" step="0.001"></div>
  <div class="row"><label>Time Scale: <b id="tsVal"></b></label><input id="ts" type="range" min="0.2" max="2.5" step="0.01"></div>
  <div class="row"><label>BH Gravity Multiplier: <b id="bhgVal"></b></label><input id="bhg" type="range" min="1" max="30" step="1"></div>
  <div class="row"><label>Labels</label><input id="labels" type="checkbox" checked></div>
  <div class="row"><label>Max Bodies: <b id="mbVal"></b></label><input id="maxb" type="range" min="10" max="300" step="10"></div>

  <div class="row"><small>
    Controls: Left-drag empty = pan ‚Ä¢ Wheel = zoom (cursor-centered) ‚Ä¢ Shift+drag = move a body ‚Ä¢
    Wheel on body = change mass ‚Ä¢ <b>Right-click a body = delete</b>
  </small></div>
  <div class="row"><span id="fps">FPS</span></div>
</div>

<script>
/* ============================================================
 * CHUNK 1 ‚Äî Core + Visuals
 * ============================================================ */

const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d',{alpha:false});
const DPR=Math.max(1,Math.min(2,window.devicePixelRatio||1));
let W=0,H=0;

function resize(){
  W=window.innerWidth; H=window.innerHeight;
  canvas.width=W*DPR; canvas.height=H*DPR;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
  buildBackgroundCache();
}
window.addEventListener('resize',resize);

const cam={x:0,y:0,z:1.0};
const toScreen=(wx,wy)=>[(wx-cam.x)*cam.z+W/2,(wy-cam.y)*cam.z+H/2];
const toWorld=(sx,sy)=>[(sx-W/2)/cam.z+cam.x,(sy-H/2)/cam.z+cam.y];

// Zoom
canvas.addEventListener('wheel',e=>{
  const zoomFactor=Math.exp(-e.deltaY*0.0015);
  const [wx,wy]=toWorld(e.clientX,e.clientY);
  cam.z=Math.max(0.2,Math.min(4.0,cam.z*zoomFactor));
  const [wx2,wy2]=toWorld(e.clientX,e.clientY);
  cam.x+=(wx-wx2); cam.y+=(wy-wy2);
  e.preventDefault();
},{passive:false});

// Pan
let panning=false,panStart=[0,0],camStart=[0,0];
canvas.addEventListener('pointerdown',e=>{
  if(e.buttons===1 && !e.shiftKey){
    panning=true;panStart=[e.clientX,e.clientY];camStart=[cam.x,cam.y];
    canvas.setPointerCapture(e.pointerId);
  }
});
canvas.addEventListener('pointermove',e=>{
  if(panning){
    const dx=(e.clientX-panStart[0])/cam.z;
    const dy=(e.clientY-panStart[1])/cam.z;
    cam.x=camStart[0]-dx; cam.y=camStart[1]-dy;
  }
});
canvas.addEventListener('pointerup',()=>{panning=false;});

// Background
const bgCanvas=document.createElement('canvas');
const bgctx=bgCanvas.getContext('2d');
let BG_W=3072,BG_H=3072;

function buildBackgroundCache(){
  BG_W=BG_H=3072;
  bgCanvas.width=BG_W; bgCanvas.height=BG_H;

  const g=bgctx.createRadialGradient(BG_W*0.6,BG_H*0.35,40,BG_W*0.5,BG_H*0.5,Math.hypot(BG_W,BG_H)*0.9);
  g.addColorStop(0.0,'#3f3a6b');
  g.addColorStop(0.35,'#2b2f56');
  g.addColorStop(0.72,'#171a2a');
  g.addColorStop(1.0,'#0b0c13');
  bgctx.fillStyle=g; bgctx.fillRect(0,0,BG_W,BG_H);

  // Nebula fog
  bgctx.globalAlpha=0.06;
  for(let i=0;i<8;i++){
    const x=Math.random()*BG_W,y=Math.random()*BG_H;
    const r=Math.random()*BG_W*0.3+BG_W*0.15;
    const fog=bgctx.createRadialGradient(x,y,r*0.2,x,y,r);
    fog.addColorStop(0,'rgba(180,120,255,0.8)');
    fog.addColorStop(1,'rgba(0,0,0,0)');
    bgctx.fillStyle=fog; bgctx.beginPath(); bgctx.arc(x,y,r,0,Math.PI*2); bgctx.fill();
  }
  bgctx.globalAlpha=1;

  // Stars
  for(let i=0;i<1800;i++){
    const x=Math.random()*BG_W,y=Math.random()*BG_H;
    const r=Math.random()*1.4;
    const a=0.18+Math.random()*0.65;
    bgctx.globalAlpha=a;
    bgctx.fillStyle=(Math.random()<0.7)?'#e8edff':'#ffd9b0';
    bgctx.beginPath(); bgctx.arc(x,y,r,0,Math.PI*2); bgctx.fill();
  }
  bgctx.globalAlpha=1;
}

function drawBackground(){
  const vw=W/cam.z,vh=H/cam.z;
  const sx=cam.x-vw/2,sy=cam.y-vh/2;
  const x0=Math.floor(sx/BG_W)*BG_W,y0=Math.floor(sy/BG_H)*BG_H;
  for(let y=y0;y<sy+vh;y+=BG_H){
    for(let x=x0;x<sx+vw;x+=BG_W){
      const [sx0,sy0]=toScreen(x,y);
      ctx.drawImage(bgCanvas,sx0,sy0,BG_W*cam.z,BG_H*cam.z);
    }
  }
}

// Names + colors
const NAME={
  stars:["Sun","Sirius","Proxima","Betelgeuse","Rigel","Vega","Altair","Deneb","Arcturus","Polaris"],
  planets:["Mercury","Venus","Earth","Mars","Jupiter","Saturn","Uranus","Neptune"],
  blackholes:["Sagittarius A*","M87*","Cygnus X-1","TON 618"]
};
const TYPE={BH:'bh',STAR:'star',PLANET:'planet'};
const rand=(a=0,b=1)=>a+Math.random()*(b-a);
const TAU=Math.PI*2;

const STAR_CLASSES=[{color:'#ffcc6f',weight:0.7},{color:'#ffd2a1',weight:0.3},{color:'#a6c8ff',weight:0.2},{color:'#ff8c6f',weight:0.1},{color:'#c2e0ff',weight:0.05}];
function pickStarColor(){
  let sum=STAR_CLASSES.reduce((s,c)=>s+c.weight,0),r=Math.random(),acc=0;
  for(const c of STAR_CLASSES){acc+=c.weight/sum;if(r<acc)return c.color;}
  return '#fff';
}
const planetPalette=['#8fd3ff','#9ae6b4','#eab1ff','#ffd6a5','#c0b6ff','#a1f0ff','#ffadbc','#9cffd1'];

function randomName(type){
  if(type===TYPE.BH) return NAME.blackholes[(Math.random()*NAME.blackholes.length)|0];
  if(type===TYPE.STAR) return NAME.stars[(Math.random()*NAME.stars.length)|0];
  return NAME.planets[(Math.random()*NAME.planets.length)|0];
}
</script>
</body>
</html>
