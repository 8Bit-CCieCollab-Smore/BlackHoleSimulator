<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Black Hole Simulator</title>
  <style>
    body { margin:0; overflow:hidden; background:#111; color:white; font-family:sans-serif; }
    #ui {
      position:absolute; top:10px; left:10px;
      background:rgba(0,0,0,0.6); padding:10px; border-radius:8px;
    }
    #ui button,#ui select,#ui input { margin:4px; }
    canvas { display:block; }
  </style>
</head>
<body>
  <canvas id="sim"></canvas>
  <div id="ui">
    <select id="objectType">
      <option value="blackhole">Black Hole</option>
      <option value="star">Star</option>
      <option value="planet">Planet</option>
    </select>
    <button id="addObject">Add</button>
    <button id="clear">Clear</button>
    <label>
      Speed:
      <input type="range" id="speed" min="0.1" max="3" step="0.1" value="1">
    </label>
  </div>
  <script>
    const canvas=document.getElementById("sim");
    const ctx=canvas.getContext("2d");
    resizeCanvas(); window.addEventListener("resize",resizeCanvas);

    let objects=[], particles=[], simulationSpeed=1;

    class Body{
      constructor(x,y,mass,type){
        this.x=x; this.y=y;
        this.vx=0; this.vy=0;
        this.mass=mass; this.type=type;
        this.radius=Math.cbrt(mass)*2;
        this.destroyed=false;
      }
      draw(){
        ctx.beginPath();
        if(this.type==="blackhole"){
          ctx.fillStyle="black";
          ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
          ctx.fill();
        } else {
          ctx.fillStyle=this.type==="star"?"yellow":"lightblue";
          ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);
          ctx.fill();
        }
      }
    }

    class Particle{
      constructor(x,y,vx,vy,color){
        this.x=x; this.y=y;
        this.vx=vx; this.vy=vy;
        this.color=color;
        this.life=2000;
        this.history=[];
      }
      update(bh){
        let dx=bh.x-this.x, dy=bh.y-this.y;
        let distSq=dx*dx+dy*dy, dist=Math.sqrt(distSq);
        let G=2.0;
        let F=G/(distSq+1);
        this.vx+=F*dx/dist*simulationSpeed;
        this.vy+=F*dy/dist*simulationSpeed;

        // drag for stability
        this.vx*=0.9995;
        this.vy*=0.9995;

        this.x+=this.vx*simulationSpeed;
        this.y+=this.vy*simulationSpeed;

        this.history.push({x:this.x,y:this.y});
        if(this.history.length>30) this.history.shift();
        this.life--;
      }
      draw(){
        ctx.strokeStyle=this.color;
        ctx.globalAlpha=Math.max(this.life/2000,0.2);
        ctx.beginPath();
        for(let i=0;i<this.history.length;i++){
          let p=this.history[i];
          if(i===0) ctx.moveTo(p.x,p.y); else ctx.lineTo(p.x,p.y);
        }
        ctx.stroke();
        ctx.globalAlpha=1;
      }
    }

    function spawnDisk(bh,color){
      for(let ang=0;ang<Math.PI*2;ang+=0.15){
        let r=bh.radius*4+Math.random()*25;
        let px=bh.x+Math.cos(ang)*r;
        let py=bh.y+Math.sin(ang)*r;
        // tangential velocity
        let orbital=Math.sqrt(bh.mass)/r*4;
        let vx=-Math.sin(ang)*orbital;
        let vy=Math.cos(ang)*orbital;
        particles.push(new Particle(px,py,vx,vy,color));
      }
    }

    function updatePhysics(){
      for(let i=0;i<objects.length;i++){
        let a=objects[i]; if(a.destroyed) continue;
        for(let j=i+1;j<objects.length;j++){
          let b=objects[j]; if(b.destroyed) continue;
          let dx=b.x-a.x, dy=b.y-a.y;
          let distSq=dx*dx+dy*dy, dist=Math.sqrt(distSq);
          if(dist<1) continue;
          let F=(a.mass*b.mass)/distSq;
          let fx=F*dx/dist, fy=F*dy/dist;
          a.vx+=fx/a.mass*simulationSpeed*0.02;
          a.vy+=fy/a.mass*simulationSpeed*0.02;
          b.vx-=fx/b.mass*simulationSpeed*0.02;
          b.vy-=fy/b.mass*simulationSpeed*0.02;

          // spaghettify stars into disk
          if((a.type!=="blackhole"&&b.type==="blackhole")||(b.type!=="blackhole"&&a.type==="blackhole")){
            let star=a.type==="blackhole"?b:a;
            let bh=a.type==="blackhole"?a:b;
            if(dist<bh.radius*8 && !star.destroyed){
              star.mass*=0.995;
              star.radius=Math.cbrt(star.mass)*2;
              // shed orbital fragments
              if(Math.random()<0.3){
                let angle=Math.atan2(star.y-bh.y,star.x-bh.x);
                let r=dist;
                let orbital=Math.sqrt(bh.mass)/r*4;
                let vx=-Math.sin(angle)*orbital;
                let vy=Math.cos(angle)*orbital;
                particles.push(new Particle(star.x,star.y,vx,vy,star.type==="star"?"orange":"lightblue"));
              }
              if(star.mass<15){
                star.destroyed=true;
                spawnDisk(bh,star.type==="star"?"orange":"lightblue");
              }
            }
          }
        }
      }

      // update objects
      for(let obj of objects){
        if(obj.destroyed) continue;
        obj.x+=obj.vx*simulationSpeed;
        obj.y+=obj.vy*simulationSpeed;
      }

      // update particles
      let bh=objects.find(o=>o.type==="blackhole");
      if(bh){
        for(let p of particles) p.update(bh);
        particles=particles.filter(p=>p.life>0);
      }
    }

    function distortPoint(x,y){
      let ox=0,oy=0;
      for(let obj of objects){
        if(obj.type!=="blackhole") continue;
        let dx=x-obj.x, dy=y-obj.y;
        let distSq=dx*dx+dy*dy, dist=Math.sqrt(distSq);
        if(dist<400){
          let s=(obj.radius*400)/(distSq+50);
          ox+=-dx/dist*s; oy+=-dy/dist*s;
        }
      }
      return [x+ox,y+oy];
    }

    function drawGrid(){
      let step=60;
      ctx.strokeStyle="rgba(200,200,200,0.2)";
      for(let x=0;x<canvas.width;x+=step){
        ctx.beginPath();
        for(let y=0;y<=canvas.height;y+=step){
          let [dx,dy]=distortPoint(x,y);
          if(y===0) ctx.moveTo(dx,dy); else ctx.lineTo(dx,dy);
        }
        ctx.stroke();
      }
      for(let y=0;y<canvas.height;y+=step){
        ctx.beginPath();
        for(let x=0;x<=canvas.width;x+=step){
          let [dx,dy]=distortPoint(x,y);
          if(x===0) ctx.moveTo(dx,dy); else ctx.lineTo(dx,dy);
        }
        ctx.stroke();
      }
    }

    function render(){
      ctx.fillStyle="rgba(17,17,17,0.5)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      drawGrid();
      for(let obj of objects) if(!obj.destroyed) obj.draw();
      for(let p of particles) p.draw();
    }

    function loop(){
      updatePhysics(); render();
      requestAnimationFrame(loop);
    }
    loop();

    // UI
    function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
    document.getElementById("addObject").onclick=()=>{
      let type=document.getElementById("objectType").value;
      if(type==="blackhole") objects.push(new Body(canvas.width/2,canvas.height/2,2000,"blackhole"));
      else if(type==="star") objects.push(new Body(Math.random()*canvas.width,Math.random()*canvas.height,400,"star"));
      else objects.push(new Body(Math.random()*canvas.width,Math.random()*canvas.height,100,"planet"));
    };
    document.getElementById("clear").onclick=()=>{objects=[];particles=[];};
    document.getElementById("speed").oninput=(e)=>simulationSpeed=parseFloat(e.target.value);
  </script>
</body>
</html>
